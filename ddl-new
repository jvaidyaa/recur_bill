create table ACCOUNT
(
ACCOUNT_ID NUMBER(12) not null
constraint ACCOUNT_PK
primary key,
GUID VARCHAR2(40),
MERCHANT_ID VARCHAR2(40),
EMAIL_ADDRESS VARCHAR2(192),
CREATED_DT DATE default sysdate not null,
LAST_MODIFIED_BY VARCHAR2(30) not null
)
/

create unique index ACCOUNT__GLOBAL_ACCT_ID_IDX
on ACCOUNT (GUID)
/


create table CRYPTO
(
PAYMENT_TOKEN VARCHAR2(50) not null
constraint PAYMENT_TOKEN_PK
primary key,
ENCRYPTED_ACCOUNT_NUMBER VARCHAR2(200) not null,
CREATED_DT DATE default sysdate not null,
LAST_MODIFIED_BY VARCHAR2(30) not null,
LAST_MODIFIED_DT DATE,
CREATED_BY VARCHAR2(30)
)
/


create table PAYMENT_METHOD
(
PAYMENT_METHOD_ID NUMBER(12) not null
constraint PAYMENT_METHOD_PK
primary key,
PM_ID NUMBER(10) not null,
ROUTING_NUMBER VARCHAR2(30),
CREATED_DT DATE default sysdate not null,
LAST_MODIFIED_BY VARCHAR2(30) not null,
LAST_MODIFIED_DT DATE,
CREATED_BY VARCHAR2(30),
PAYMENT_TOKEN VARCHAR2(255)
)
/

create index PAYMENT_METHOD_TOKEN_IDX
on PAYMENT_METHOD (PAYMENT_TOKEN)
/

create index PAYMENT_METHOD_IDX
on PAYMENT_METHOD (PM_ID, PAYMENT_METHOD_ID, PAYMENT_TOKEN)
/




create table ACCOUNT_PAYMENT_METHOD
(
ACCOUNT_ID NUMBER(12) not null
constraint ACCOUNT__ACCT_ID3_FK
references ACCOUNT,
PAYMENT_METHOD_ID NUMBER(12) not null
constraint PAYMENT_METHOD__PM_ID1_FK
references PAYMENT_METHOD,
NICK_NAME VARCHAR2(48),
FIRST_NAME VARCHAR2(48),
MIDDLE_NAME VARCHAR2(48),
LAST_NAME VARCHAR2(48),
STREET VARCHAR2(192),
APT_SUITE VARCHAR2(96),
STREET3 VARCHAR2(192),
CITY VARCHAR2(90),
STATE_PROVINCE VARCHAR2(96) not null,
ZIP_POSTAL_CODE VARCHAR2(36) not null,
COUNTY_PREFECTURE VARCHAR2(96),
COUNTRY CHAR(2),
STATUS NUMBER(5) not null,
DEFAULT_FLAG CHAR default 0 not null,
INSTRUMENT_FLAG CHAR default 0 not null,
CREATED_DT DATE default SYSDATE not null,
LAST_MODIFIED_BY VARCHAR2(30) not null,
LAST_MODIFIED_DT DATE,
CREATED_BY VARCHAR2(30),
PM_ID NUMBER(10) not null,
EXPIRATION_DT CHAR(4),
EMAIL_ADDRESS VARCHAR2(192),
MERCHANT_ID VARCHAR2(255 char),
ACCOUNT_HOLDER_NAME VARCHAR2(128),
constraint ACCT_PM_PK
primary key (ACCOUNT_ID, PAYMENT_METHOD_ID)
)
/

create index ACCT_PM_PAYMENT_METHOD_ID_IDX
on ACCOUNT_PAYMENT_METHOD (PAYMENT_METHOD_ID)
/

create index ACCT_PM_FIRST_NAME_IDX
on ACCOUNT_PAYMENT_METHOD (FIRST_NAME, LAST_NAME)
/

create index ACCT_PM_LAST_NAME_IDX
on ACCOUNT_PAYMENT_METHOD (LAST_NAME, FIRST_NAME)
/

create index ACCOUNT_EMAIL_ADD_IDX
on ACCOUNT_PAYMENT_METHOD (EMAIL_ADDRESS)
/




create table OFFERS
(
OFFER_ID NUMBER not null
constraint OFFER_IDX_PK
primary key,
CREATED_DT DATE,
CREATED_BY VARCHAR2(40),
LAST_UPDATED_DT DATE,
UPDATED_BY VARCHAR2(40),
UPDATED_DESC VARCHAR2(255),
LANGUAGE_CODE VARCHAR2(32) default 'en' not null,
LANGUAGE_NAME VARCHAR2(40),
COUNTRY_CODE VARCHAR2(10) default 'US',
OFFER_LABEL VARCHAR2(255),
OFFER_SHORT_DSCR VARCHAR2(255),
OFFER_PRICE NUMBER(12,2) default 0.00,
TRIAL_AMT NUMBER,
TRIAL_TYPE VARCHAR2(50) default 'DAY'
)
/



create table SUB_STATUS_T
(
STATUS_ID NUMBER
constraint PK_STATUS_ID
primary key,
STATUS VARCHAR2(30),
AR_BILLABLE VARCHAR2(1) default 'N',
CREATED_BY VARCHAR2(40),
CREATED_DT DATE,
UPDATED_DESC VARCHAR2(255),
UPDATED_BY VARCHAR2(40),
LAST_UPDATED_DT DATE
)
/

create unique index PK_STATUS_ID
on SUB_STATUS_T (STATUS_ID)
/



create table SUBSCRIPTIONS
(
GUID VARCHAR2(40) not null,
OFFER_ID NUMBER not null,
SUBSCRIPTION_ID NUMBER
constraint PK_SUBSCRIPTION_ID
primary key,
EXTERNAL_SUBSCRIPTION_ID VARCHAR2(100),
OFFER_SUBSCRIPTION_ID NUMBER,
STATUS NUMBER not null
constraint FK_SUB_STATUS
references SUB_STATUS_T,
END_DT DATE,
ORDER_ID VARCHAR2(60),
CREATED_DT DATE not null,
LAST_UPDATED_DT DATE,
CREATED_BY VARCHAR2(40),
UPDATED_BY VARCHAR2(40),
UPDATED_DESC VARCHAR2(255),
PRODUCT_ID NUMBER,
PRODUCT_NAME VARCHAR2(255),
PAYMENT_METHOD_ID VARCHAR2(60),
CANCEL_DT DATE,
SUSPEND_DT DATE,
SALE_PRICE NUMBER(12,2),
TRIAL_TYPE VARCHAR2(20),
TRIAL_AMOUNT NUMBER,
CANCEL_REASON VARCHAR2(255),
PURCHASE_DT DATE,
BILL_CYCLE NUMBER
)
/


create index SUB_T_OFFER_SUB_ID_IDX
on SUBSCRIPTIONS (OFFER_SUBSCRIPTION_ID)
/



create index SUB_T_ORDER_ID_IDX
on SUBSCRIPTIONS (ORDER_ID)
/




create index SUB_T_PRODUCT_ID_IDX
on SUBSCRIPTIONS (PRODUCT_ID)
/




create table SUB_BILLING_DETAILS_T
(
SUBSCRIPTION_ID NUMBER(19) not null
constraint SUB_BILLING_DETAILS_T_PK
primary key,
CYCLE_DAY NUMBER,
BILL_START_DT DATE,
BILL_END_DT DATE,
CURRENCY VARCHAR2(10),
TRIAL_START_DT DATE,
TRIAL_END_DT DATE,
TRIAL_MONTHS_OR_DAYS NUMBER,
PURCHASE_PRORATION_FLAG NUMBER,
CANCEL_PRORATION_FLAG NUMBER,
MMC_CYCLE_FLAG NUMBER,
TIERD_RESOURCE_BAL NUMBER,
BILLING_STATUS VARCHAR2(10),
CREATED_BY VARCHAR2(60) not null,
CREATED_DT DATE not null,
UPDATED_BY VARCHAR2(60),
LAST_UPDATED_DT DATE,
UPDATED_DESC VARCHAR2(255),
BILL_FUTURE_DT DATE,
CHARGE_START_DT DATE,
CHARGE_END_DT DATE,
PURCHASE_START_DT DATE,
PURCHASE_END_DT DATE
)
/

create index SUB_BILLING_BILL_END_DT_IDX
on SUB_BILLING_DETAILS_T (BILL_END_DT)
/
